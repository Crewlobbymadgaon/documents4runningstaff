<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes">
    
    <title>Shed Order</title>
    <link rel="manifest" href="/documents4runningstaff/manifest.json" />
    <link rel="icon" href="/documents4runningstaff/favicon.ico" />
    <link rel="apple-touch-icon" href="/documents4runningstaff/icon-192.png" />

    
    <meta name="theme-color" content="#1f2937" />

    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
      <script defer src="main.js"></script>

    <style>
      .font-rajdhani {
        font-family: 'Rajdhani', sans-serif;
      }
      
  #zoomWrapper {
    overflow: auto;
    touch-action: none; /* Prevent default pinch gestures */
  }

  #pdfViewer {
    transform-origin: center center;
    will-change: transform;
    transition: transform 0.2s ease-out;
  }

      
  .touch-zoom {
    touch-action: none;
    overflow: hidden;
    position: relative;
  }



  .pinch-container {
    transform-origin: 0 0;
  }

      
    </style>
  </head>
  <body class="bg-gray-50 text-gray-800">

<header class="bg-gradient-to-r from-blue-900 via-blue-700 to-blue-900 text-white py-3 shadow-md">
  <div class="text-center px-4">
  
<h1 class="font-rajdhani text-xl sm:text-3xl md:text-4xl leading-tight font-extrabold">
      Digital Library
      <span class="text-yellow-300">for</span>
      Running Staff
</h1>
  <!-- Subheading -->
  <h2 class="font-rajdhani text-4xl sm:text-4xl md:text-5xl font-extrabold mt-2">
    Shed Order
  </h2>
      <h3 class="font-rajdhani text-2xl sm:text-2xl md:text-3xl font-extrabold mt-2">
        Madgaon Lobby
      </h3>
    </div>

<!-- Year Selector (center) and Hamburger (right) on same line -->
<div class="flex items-center justify-between mt-6">
  
  <!-- Invisible spacer to balance hamburger button -->
  <div class="w-12"></div>

<!-- Centered Year Selector with padding compensation -->
<div class="relative inline-block w-40">
  <select id="yearSelect" onchange="highlightSelectedYear()"
    class="appearance-none w-full bg-gradient-to-b from-blue-900 via-blue-500 to-blue-900
           text-white text-xl font-bold 
           px-0 py-2 rounded-md border border-blue-950 
           focus:bg-blue-950 focus:outline-none focus:ring-1 focus:ring-blue-950 shadow 
           text-center">
    <option class="bg-white text-blue-900 hover:bg-blue-100 transition duration-150 ease-in-out" value="2024">&nbsp;&nbsp;&nbsp;&nbsp;2024&nbsp;&nbsp;&nbsp;&nbsp;</option>
    <option class="bg-white text-blue-900 hover:bg-blue-100 transition duration-150 ease-in-out" value="2025">&nbsp;&nbsp;&nbsp;&nbsp;2025&nbsp;&nbsp;&nbsp;&nbsp;</option>
  </select>

  <!-- Custom dropdown arrow -->
  <div class="pointer-events-none absolute inset-y-0 right-2 flex items-center text-white text-sm">
    â–¼
  </div>
</div>
  <!-- Hamburger + Dropdown: wrapped in a relative container -->
<div class="relative">
  <!-- Hamburger Button (right) -->
  <button id="hamburgerBtn"
    class="bg-gradient-to-b from-blue-900 via-blue-500 to-blue-900 
           hover:from-blue-800 hover:to-blue-950 
           text-white p-2 rounded-md 
           border border-blue-950 
           shadow-lg 
           focus:outline-none focus:ring-2 focus:ring-blue-900 
           transition duration-150 ease-in-out"
    aria-label="Toggle Menu" aria-expanded="false">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
      viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round"
        d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
  </button>

  <!-- Dropdown menu (now correctly aligned below hamburger) -->
  <div id="dropdownMenu"
    class="hidden absolute right-0 mt-2 bg-white border border-blue-800 shadow-lg z-50 rounded-md w-52">
    <a href="index.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Home</a>
    <a href="so_lobby_selector.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Shed Order</a>
    <a href="safetycircular.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Safety Circular</a>
    <a href="counselling.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Counselling Topics</a>
    <a href="othercirculars.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Other Circulars</a>
    <a href="gnsr.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">G&SR</a>
    <a href="accidentmanual.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Accident Manual</a>
    <a href="wtt.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">WTT</a>
    <a href="readingmaterials.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Reading Materials</a>
    <a href="tsd.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">TSD</a>
  </div>
</div>
</div> <!-- Ends the flex row: justify-between -->
</header>





  <section class="px-4 mt-8">
  <div id="shedOrderList" class="grid gap-4 max-w-2xl mx-auto"></div>
  </section>

  <!-- Modal -->

<!-- Modal -->
<div id="documentModal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden">
  <div class="bg-white w-full max-w-4xl h-[90vh] flex flex-col rounded-lg shadow-lg relative overflow-hidden">

    <!-- Header -->
    <div class="flex justify-between items-center px-4 py-2 bg-blue-700 text-white text-lg font-semibold">
      <span id="documentTitle">Document Viewer</span>
      <div class="flex items-center space-x-2">
        <button onclick="acknowledgeDocument()" class="bg-green-600 px-3 py-1 rounded text-sm hover:bg-green-700">Acknowledge</button>
        <button onclick="closeModal()" class="text-white text-2xl">&times;</button>
      </div>
    </div>

    <!-- Zoom Wrapper -->
    <div id="zoomWrapper" class="flex-1 overflow-hidden relative touch-none bg-gray-100">
      <div id="pdfViewer" class="w-full h-full transform transition-transform duration-100 ease-out origin-center flex items-center justify-center">
        <img id="documentImage" src="" alt="Document" class="w-full h-auto max-w-none" />
      </div>
    </div>
  </div>
</div>

    

  <!-- JavaScript -->
  <script>
 
 // Toggle Dropdown
const hamburgerBtn = document.getElementById("hamburgerBtn");
const dropdownMenu = document.getElementById("dropdownMenu");

hamburgerBtn.addEventListener("click", (e) => {
  e.stopPropagation(); // Prevent click from bubbling to document
  dropdownMenu.classList.toggle("hidden");

  const isHidden = dropdownMenu.classList.contains("hidden");
  hamburgerBtn.setAttribute("aria-expanded", !isHidden);
});

// Close dropdown when a link inside it is clicked
dropdownMenu.querySelectorAll("a").forEach(link => {
  link.addEventListener("click", () => {
    dropdownMenu.classList.add("hidden");
    hamburgerBtn.setAttribute("aria-expanded", "false");
  });
});

// Close dropdown if clicking outside
document.addEventListener("click", (e) => {
  if (
    !dropdownMenu.classList.contains("hidden") &&
    !dropdownMenu.contains(e.target) &&
    !hamburgerBtn.contains(e.target)
  ) {
    dropdownMenu.classList.add("hidden");
    hamburgerBtn.setAttribute("aria-expanded", "false");
  }
});
    document.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && !dropdownMenu.classList.contains("hidden")) {
    dropdownMenu.classList.add("hidden");
    hamburgerBtn.setAttribute("aria-expanded", "false");
  }
});


  function renderShedOrders(year) {
    const orders = window.shedOrdersByYear[year];
    const shedOrderList = document.getElementById("shedOrderList");
    shedOrderList.innerHTML = "";

    if (!orders || orders.length === 0) {
      shedOrderList.innerHTML = "<p class='text-center text-gray-500'>No shed orders available.</p>";
      return;
    }

    const reversedOrders = [...orders].reverse();

    reversedOrders.forEach(order => {
      const filePath = `/documents4runningstaff/doc_shed_order_mao_${year}/${order.file}`;

      const card = document.createElement("div");
      
card.className = `
  bg-white relative rounded-xl p-4 
  border-2 border-blue-300 shadow-md 
  transition duration-300 
  text-gray-800 text-base leading-relaxed break-words
`;
      card.innerHTML = `
        <div class="font-bold text-lg text-blue-900 mb-2">${order.number}</div>
        <div class="text-gray-700 mb-4">${order.topic}</div>

        <div class="flex justify-between items-center px-4 sm:px-6 md:px-8 py-2 sm:py-3">
  <!-- View Button -->
<button onclick="openModal('${filePath}')" title="View Document"
  class="flex items-center gap-2 
         text-xs sm:text-sm font-bold text-white 
         bg-gradient-to-b from-blue-900 via-blue-500 to-blue-900 
         hover:scale-105 transform transition duration-200 
         px-3 py-1.5 sm:px-4 sm:py-2 
         rounded-md border border-blue-950 shadow-lg 
         focus:outline-none">
  <svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24" class="w-4 h-4 sm:w-5 sm:h-5">
    <path d="M12 5c-7 0-9 7-9 7s2 7 9 7 9-7 9-7-2-7-9-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10zm0-8a3 3 0 1 0 0 6 3 3 0 0 0 0-6z"/>
  </svg>
  <span>View</span>
</button>

  <!-- Download Button -->
  <a href="${filePath}" download title="Download Document"
     class="flex items-center gap-2 
            text-xs sm:text-sm font-bold text-white 
            bg-gradient-to-b from-blue-900 via-blue-500 to-blue-900 
            hover:scale-105 transform transition duration-200 
            px-3 py-1.5 sm:px-4 sm:py-2 
            rounded-md border border-blue-950 shadow-lg 
            focus:outline-none">
    <svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24" class="w-4 h-4 sm:w-5 sm:h-5">
      <path d="M12 16.5l4.5-4.5h-3V3h-3v9h-3l4.5 4.5zm-9 3h18v-2H3v2z"/>
    </svg>
    <span>Download</span>
  </a>
</div>
      `;

      shedOrderList.appendChild(card);
    });
  }

  function loadShedOrders(year) {
    const existingScript = document.getElementById("shed-script");
    if (existingScript) existingScript.remove();

    const script = document.createElement("script");
    script.id = "shed-script";
    script.src = `js/shed_order_mao_${year}.js`;

    script.onload = () => {
      if (
        window.shedOrdersByYear &&
        Array.isArray(window.shedOrdersByYear[year]) &&
        window.shedOrdersByYear[year].length > 0
      ) {
        renderShedOrders(year);
      } else {
        showNoDataMessage();
      }
    };

    script.onerror = showNoDataMessage;

    document.body.appendChild(script);
  }

  function showNoDataMessage() {
    const container = document.getElementById("shedOrderList");
    container.innerHTML = `<div class="text-center text-red-600 font-semibold p-4">Data not available</div>`;
  }

  function highlightSelectedYear() {
    const year = document.getElementById("yearSelect").value;
    loadShedOrders(year);
  }

  window.addEventListener("DOMContentLoaded", () => {
    const yearSelect = document.getElementById("yearSelect");
    const currentYear = new Date().getFullYear();

    const optionExists = [...yearSelect.options].some(opt => opt.value === String(currentYear));
    yearSelect.value = optionExists ? currentYear : yearSelect.options[0].value;

    highlightSelectedYear();
  });
                         
  
  function cachePDF(url) {
    if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
      // Trigger fetch to store in cache
      fetch(url, { mode: 'no-cors' }).catch(() => {});
    }
  }

let currentDocId = null; // global tracker

function openModal(filePath, docId) {
  currentDocId = docId; // track for acknowledgment
  const modal = document.getElementById("docModal");
  const container = document.getElementById("pdfViewer");
  container.innerHTML = '';
  modal.classList.remove("hidden");
  document.body.style.overflow = "hidden"; // Prevent scroll
  history.pushState({ modalOpen: true }, "", "#doc");

  pdfjsLib.getDocument(filePath).promise.then(function (pdf) {
    for (let pageNumber = 1; pageNumber <= pdf.numPages; pageNumber++) {
      pdf.getPage(pageNumber).then(function (page) {
        const viewport = page.getViewport({ scale: 1.5 });
        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        page.render({ canvasContext: context, viewport: viewport }).promise.then(() => {
          const wrapper = document.createElement("div");
          wrapper.className = "flex justify-center w-full overflow-x-auto px-2";

          canvas.style.maxWidth = "100%";
          canvas.className = "shadow border";

          wrapper.appendChild(canvas);
          container.appendChild(wrapper);
        });
      });
    }
  }).catch(err => {
    alert("Failed to load PDF. Try again online.");
    closeModal();
  });
}

function closeModal() {
  const modal = document.getElementById("docModal");
  const container = document.getElementById("pdfViewer");
  modal.classList.add("hidden");
  container.innerHTML = '';
  document.body.style.overflow = "";

  if (location.hash === "#doc") {
    history.back();
  }
}

function acknowledgeDocument() {
  const empId = prompt("Enter your Employee ID:");
  const password = prompt("Enter your Password:");

  if (empId && password) {
    // Fake authentication for now
    alert("Acknowledged successfully.");
    
    // Save acknowledgment locally (temporary method)
    localStorage.setItem(`ack_${currentDocId}_${empId}`, true);
    
    closeModal();

    // Optional: visually update UI
    // updateAcknowledgementStatus(currentDocId, empId);
  } else {
    alert("Acknowledgement failed. Please enter both Employee ID and Password.");
  }
}

// Handle back button
window.addEventListener("popstate", () => {
  const modal = document.getElementById("docModal");
  if (!modal.classList.contains("hidden")) {
    closeModal();
  }
});

// Escape key closes modal
document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") {
    const modal = document.getElementById("docModal");
    if (!modal.classList.contains("hidden")) {
      closeModal();
    }
  }
});

    
  
  let scale = 1;
  const viewer = document.getElementById("pdfViewer");
  const wrapper = document.getElementById("zoomWrapper");

  function applyZoom() {
    viewer.style.transform = `scale(${scale})`;
  }

  function zoomIn() {
    scale = Math.min(3, scale + 0.1);
    applyZoom();
  }

  function zoomOut() {
    scale = Math.max(1, scale - 0.1); // Prevent zooming out smaller than default
    applyZoom();
  }

  function resetZoom() {
    scale = 1;
    applyZoom();
  }

  // For Ctrl + Scroll zoom (desktop)
  wrapper.addEventListener("wheel", function (e) {
    if (e.ctrlKey) {
      e.preventDefault();
      scale += e.deltaY < 0 ? 0.1 : -0.1;
      scale = Math.min(3, Math.max(1, scale));
      applyZoom();
    }
  }, { passive: false });

  // Mobile pinch-zoom support
  let lastDist = null;

  wrapper.addEventListener("touchmove", function (e) {
    if (e.touches.length === 2) {
      e.preventDefault();
      const dx = e.touches[0].clientX - e.touches[1].clientX;
      const dy = e.touches[0].clientY - e.touches[1].clientY;
      const dist = Math.sqrt(dx * dx + dy * dy);

      if (lastDist !== null) {
        const delta = dist - lastDist;
        if (Math.abs(delta) > 5) {
          scale += delta > 0 ? 0.05 : -0.05;
          scale = Math.min(3, Math.max(1, scale));
          applyZoom();
        }
      }
      lastDist = dist;
    }
  }, { passive: false });

  wrapper.addEventListener("touchend", function () {
    lastDist = null;
  });

</script>

  
 <div id="pdfLoading" class="fixed inset-0 z-40 bg-black bg-opacity-80 text-white flex items-center justify-center text-xl font-semibold hidden">
  Loading document...
    </div>
</body>
  </html
