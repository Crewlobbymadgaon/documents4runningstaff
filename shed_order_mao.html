<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shed Order</title>
    <link rel="manifest" href="/documents4runningstaff/manifest.json" />
    <link rel="icon" href="/documents4runningstaff/favicon.ico" />
    <link rel="apple-touch-icon" href="/documents4runningstaff/icon-192.png" />

    
    <meta name="theme-color" content="#1f2937" />

    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    
      <script defer src="main.js"></script>

    <style>
      .font-rajdhani {
        font-family: 'Rajdhani', sans-serif;
      }
      
    </style>
  </head>
  <body class="bg-gray-50 text-gray-800">

<header class="bg-gradient-to-r from-blue-900 via-blue-700 to-blue-900 text-white py-3 shadow-md">
  <div class="text-center px-4">
  
<h1 class="font-rajdhani text-xl sm:text-3xl md:text-4xl leading-tight font-extrabold">
      Digital Library
      <span class="text-yellow-300">for</span>
      Running Staff
</h1>
  <!-- Subheading -->
  <h2 class="font-rajdhani text-4xl sm:text-4xl md:text-5xl font-extrabold mt-2">
    Shed Order
  </h2>
      <h3 class="font-rajdhani text-2xl sm:text-2xl md:text-3xl font-extrabold mt-2">
        Madgaon Lobby
      </h3>
    </div>

<!-- Year Selector (center) and Hamburger (right) on same line -->
<div class="flex items-center justify-between mt-6">
  
  <!-- Invisible spacer to balance hamburger button -->
  <div class="w-12"></div>

<!-- Centered Year Selector with padding compensation -->
<div class="relative inline-block">
  <select id="yearSelect" onchange="highlightSelectedYear()"
  class="appearance-none bg-gradient-to-b from-blue-900 via-blue-500 to-blue-900 
         text-white text-lg font-bold text-center
         px-4 py-2 pr-10 rounded-md border border-blue-950 
         focus:bg-blue-950 focus:outline-none focus:ring-1 focus:ring-blue-950 shadow">
    <option value="2024">2024</option>
    <option value="2025">2025</option>
  </select>

  <!-- Custom dropdown arrow -->
  <div class="pointer-events-none absolute inset-y-0 right-2 flex items-center text-white text-sm">
    ▼
  </div>
</div>

  <!-- Hamburger Button (right) -->
  <button id="hamburgerBtn"
    class="bg-gradient-to-b from-blue-900 via-blue-500 to-blue-900 
           hover:from-blue-800 hover:to-blue-950 
           text-white p-2 rounded-md 
           border border-blue-950 
           shadow-lg 
           focus:outline-none focus:ring-2 focus:ring-blue-900 
           transition duration-150 ease-in-out">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
      viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round"
        d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
  </button>
</div>
</header>

<!-- Dropdown menu: right side below header -->
<div id="dropdownMenu" class="hidden absolute right-4 mt-1 bg-white border border-blue-800 shadow-lg z-50 rounded-md w-52">
  <a href="index.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Home</a>
    <a href="so_lobby_selector.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Shed Order</a>
  <a href="safetycircular.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Safety Circular</a>
  <a href="counselling.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Counselling Topics</a>
  <a href="othercirculars.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Other Circulars</a>
  <a href="gnsr.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">G&SR</a>
  <a href="accidentmanual.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Accident Manual</a>
  <a href="wtt.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">WTT</a>
  <a href="readingmaterials.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">Reading Materials</a>
  <a href="tsd.html" class="block px-4 py-2 text-blue-900 hover:bg-blue-100">TSD</a>
</div>



  <!-- Shed Order List -->
  <section class="px-4 mt-8">
    
    <div id="shedOrderList" class="grid gap-4 max-w-2xl mx-auto"></div>
    
  </section>

<!-- Modal -->
<div id="pdfModal" class="fixed inset-0 z-50 bg-black bg-opacity-80 flex items-center justify-center p-2 hidden">
  <div class="bg-white rounded-lg shadow-xl w-full max-w-5xl h-full sm:h-[90vh] overflow-hidden flex flex-col">
    <!-- Modal Header -->
    <div class="flex justify-between items-center p-4 bg-blue-800 text-white">
      <h2 id="modalTitle" class="text-lg font-bold">Document Title</h2>
      <button onclick="closeModal()" class="text-white text-xl font-bold">&times;</button>
    </div>

    <!-- PDF Viewer -->
    <iframe id="pdfViewer" class="flex-1 w-full" frameborder="0"></iframe>

    <!-- Acknowledgement Section -->
    <div class="p-4 border-t space-y-3 bg-gray-50">
      <label class="flex items-start gap-2">
        <input type="checkbox" id="ackCheckbox" class="mt-1 accent-blue-600" />
        <span class="text-sm sm:text-base">I have read and understood the contents of this Shed Order.</span>
      </label>
      <button onclick="submitAcknowledgement()" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-md disabled:opacity-50" disabled id="ackBtn">Acknowledge</button>
    </div>
  </div>
</div>
  <!-- JavaScript -->
  <script>
    let currentYear = null;
    let currentIndex = null;


   

  
    
  // Toggle Dropdown
  const hamburgerBtn = document.getElementById("hamburgerBtn");
  const dropdownMenu = document.getElementById("dropdownMenu");

  hamburgerBtn.addEventListener("click", () => {
    dropdownMenu.classList.toggle("hidden");
  });

  dropdownMenu.querySelectorAll("a").forEach(link => {
    link.addEventListener("click", () => {
      dropdownMenu.classList.add("hidden");
    });
  });
  
  
 

function renderShedOrders(year) {
  const orders = window.shedOrdersByYear[year];
  const shedOrderList = document.getElementById("shedOrderList");
  shedOrderList.innerHTML = "";

  if (!orders || orders.length === 0) {
    shedOrderList.innerHTML = "<p class='text-center text-gray-500'>No shed orders available.</p>";
    return;
  }

  const reversedOrders = [...orders].reverse();

  reversedOrders.forEach((order, reversedIndex) => {
    const actualIndex = orders.length - 1 - reversedIndex;
    const isAcknowledged = localStorage.getItem(`ack_${year}_${actualIndex}`) === "true";

    const card = document.createElement("div");
    card.className = "bg-white relative rounded-lg p-4 shadow-md border border-blue-100";

    const filePath = `/documents4runningstaff/doc_shed_order_mao_${year}/${order.file}`;

    card.innerHTML = `
      <div class="font-bold text-lg text-blue-900 mb-2">${order.number}</div>
      <div class="text-gray-700 mb-4">${order.topic}</div>
      
      <div class="flex flex-wrap justify-between items-center gap-2 mt-4">
        <button 
          onclick="openModal('${order.number}', '${filePath}', '${year}', ${actualIndex})"
          class="bg-blue-700 hover:bg-blue-800 text-white text-sm font-semibold px-4 py-2 rounded">
          Read & Acknowledge
        </button>

        <a href="${filePath}" target="_blank"
          class="bg-gray-600 hover:bg-gray-700 text-white text-sm font-semibold px-4 py-2 rounded">
          Download / Open
        </a>

        <span id="status_${year}_${actualIndex}"
          class="${isAcknowledged ? 'bg-green-600' : 'bg-gray-400'} text-white text-xs px-2 py-1 rounded-full">
          ${isAcknowledged ? '✅ Acknowledged' : '❌ Not Acknowledged'}
        </span>
      </div>
    `;

    shedOrderList.appendChild(card);
  });
}

window.addEventListener("DOMContentLoaded", () => {
  const yearSelect = document.getElementById("yearSelect");
  const currentYear = new Date().getFullYear();

  // Check if the current year exists in the dropdown
  const optionExists = [...yearSelect.options].some(opt => opt.value === String(currentYear));

  if (optionExists) {
    yearSelect.value = currentYear;
    highlightSelectedYear(); // Automatically load current year's data
  } else {
    yearSelect.selectedIndex = 0; // Fallback to first option
    highlightSelectedYear();      // Load default year
  }
});


function openModal(title, filePath, year, index) {
  currentYear = year;
  currentIndex = index;

  const modal = document.getElementById('pdfModal');
  const viewer = document.getElementById('pdfViewer');
  const modalTitle = document.getElementById('modalTitle');
  const loading = document.getElementById('pdfLoading');
  const ackSection = document.querySelector('.p-4.border-t');
  const ackCheckbox = document.getElementById('ackCheckbox');
  const ackBtn = document.getElementById('ackBtn');

  // Reset PDF
  viewer.src = "";
  viewer.style.display = "none";

  // Set title
  modalTitle.textContent = title;

  // Show loading screen
  loading.classList.remove('hidden');

  // Load PDF
  viewer.onload = () => {
    loading.classList.add('hidden');
    modal.classList.remove('hidden');
    viewer.style.display = "block";
  };

  viewer.onerror = () => {
    loading.textContent = "⚠️ Failed to load document. Try again later.";
  };

  viewer.src = filePath;

  // Show/hide acknowledgement section
  const isAcknowledged = localStorage.getItem(`ack_${year}_${index}`) === "true";
  if (isAcknowledged) {
    ackSection.classList.add('hidden');
  } else {
    ackCheckbox.checked = false;
    ackBtn.disabled = true;
    ackSection.classList.remove('hidden');
  }
}

  function closeModal() {
  document.getElementById('pdfModal').classList.add('hidden');
  document.getElementById('pdfViewer').src = "";
  document.getElementById('pdfViewer').style.display = "none";
  document.getElementById('pdfLoading').classList.add('hidden');
}

  function submitAcknowledgement() {
  if (currentYear !== null && currentIndex !== null) {
    const key = `ack_${currentYear}_${currentIndex}`;
    localStorage.setItem(key, "true");
    highlightSelectedYear(); // Refresh shed order cards with updated status
  }

  closeModal();
}



// Set current year as selected if available in options
if ([...yearSelect.options].some(opt => opt.value === String(currentYear))) {
  yearSelect.value = currentYear;
  highlightSelectedYear();
}
    function acknowledge(year, index) {
  localStorage.setItem(`ack_${year}_${index}`, "true");

  // Update status text
  const status = document.getElementById(`status_${year}_${index}`);
  if (status) {
    status.textContent = '✅ Acknowledged';
    status.className = "bg-green-600 text-white text-xs px-2 py-1 rounded-full text-right";
  }

  // Disable the button
  const btn = document.getElementById(`ackBtn_${year}_${index}`);
  if (btn) {
    btn.disabled = true;
    btn.textContent = 'Acknowledged';
  }
    }

  function loadShedOrders(year) {
    const existingScript = document.getElementById("shed-script");
    if (existingScript) existingScript.remove();

    const script = document.createElement("script");
    script.id = "shed-script";
    script.src = `scripts/shed_order_mao_${year}.js`;

    script.onload = () => {
      if (
        window.shedOrdersByYear &&
        Array.isArray(window.shedOrdersByYear[year]) &&
        window.shedOrdersByYear[year].length > 0
      ) {
        renderShedOrders(year);
      } else {
        showNoDataMessage();
      }
    };

    script.onerror = showNoDataMessage;

    document.body.appendChild(script);
  }

  function showNoDataMessage() {
    const container = document.getElementById("shedOrderList");
    container.innerHTML = `<div class="text-center text-red-600 font-semibold p-4">Data not available</div>`;
  }

  function highlightSelectedYear() {
    const year = document.getElementById("yearSelect").value;
    loadShedOrders(year);
  }



  </script>
    <div id="pdfLoading" class="fixed inset-0 z-40 bg-black bg-opacity-80 text-white flex items-center justify-center text-xl font-semibold hidden">
  Loading document...
    </div>
</body>
  </html
